{% extends 'news/base.html' %}

{% block content %}
<h1>Предложить новость</h1>

<div class="container-fluid">
    <div class="row">
        <div class="col-12 col-lg-12">
            {% if user.is_authenticated %}
            <form method="post" enctype="multipart/form-data" novalidate>
                {% csrf_token %}
                <div class="mb-3">
                    <label for="{{ form.title.id_for_label }}" class="form-label">{{ form.title.label }}</label>
                    <input type="text" name="{{ form.title.name }}" id="{{ form.title.id_for_label }}" class="form-control form-control-lg" required>
                    {% if form.title.errors %}
                        <div class="alert alert-danger mt-1">{{ form.title.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="{{ form.brief.id_for_label }}" class="form-label">{{ form.brief.label }}</label>
                    <textarea name="{{ form.brief.name }}" id="{{ form.brief.id_for_label }}" class="form-control" rows="3" required></textarea>
                    {% if form.brief.errors %}
                        <div class="alert alert-danger mt-1">{{ form.brief.errors.as_text }}</div>
                    {% endif %}
                </div>
                <div class="mb-3">
                    <label for="{{ form.content.id_for_label }}" class="form-label">{{ form.content.label }}</label>
                    <textarea name="{{ form.content.name }}" id="{{ form.content.id_for_label }}" class="form-control" rows="6" required></textarea>
                    {% if form.content.errors %}
                        <div class="alert alert-danger mt-1">{{ form.content.errors.as_text }}</div>
                    {% endif %}
                </div>
                
                <!-- Таблица с фиксированным размером и прокруткой -->
                <div class="mb-3">
                    <label class="form-label">Теги:</label>
                    <div style="overflow-x: auto; max-width: 100%; height: 300px;">
                        <table class="table table-bordered" style="min-width: 1100px;">
                            <thead>
                                <tr>
                                    <th colspan="5">Теги</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for tag in form.tags %}
                                {% if forloop.counter0|divisibleby:5 %}
                                <tr>
                                {% endif %}
                                    <td>
                                        <input type="checkbox" name="{{ tag.data.name }}" id="{{ tag.id_for_label }}" value="{{ tag.data.value }}">
                                        <label for="{{ tag.id_for_label }}">{{ tag.choice_label }}</label>
                                    </td>
                                {% if forloop.counter0|add:1|divisibleby:5 or forloop.last %}
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% if form.tags.errors %}
                        <div class="alert alert-danger mt-1">{{ form.tags.errors.as_text }}</div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    <label for="{{ form.image.id_for_label }}" class="form-label">{{ form.image.label }}</label>
                    <input type="file" name="{{ form.image.name }}" id="{{ form.image.id_for_label }}" class="form-control" accept="image/*">
                    {% if form.image.errors %}
                        <div class="alert alert-danger mt-1">{{ form.image.errors.as_text }}</div>
                    {% endif %}
                </div>

                <div class="mb-3">
                    {% if form.non_field_errors %}
                        <div class="alert alert-danger">{{ form.non_field_errors }}</div>
                    {% endif %}
                </div>

                <button type="submit" class="btn btn-dark">Отправить</button>
            </form>

            {% else %}
            <div class="alert alert-warning" role="alert">
                Для того чтобы предложить новость, пожалуйста, <a href="{% url 'login' %}">авторизуйтесь</a>.
                Если у вас нет аккаунта, <a href="{% url 'register' %}">зарегистрируйтесь</a>.
            </div>

            {% endif %}
        </div>
        {% if user.is_authenticated %}
    </div>
</div>
{% endif %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Получение элементов формы
        const titleInput = document.getElementById('{{ form.title.id_for_label }}');
        const briefInput = document.getElementById('{{ form.brief.id_for_label }}');
        const contentInput = document.getElementById('{{ form.content.id_for_label }}');
        const imageInput = document.getElementById('{{ form.image.id_for_label }}');

        // Получение элементов preview
        const previewTitle = document.getElementById('preview-title');
        const previewBrief = document.getElementById('preview-brief');
        const previewContent = document.getElementById('preview-content');
        const previewImage = document.getElementById('preview-image');

        // Обновление preview при изменении полей формы
        titleInput.addEventListener('input', function() {
            previewTitle.textContent = titleInput.value;
        });

        briefInput.addEventListener('input', function() {
            previewBrief.textContent = briefInput.value;
        });

        contentInput.addEventListener('input', function() {
            previewContent.textContent = contentInput.value;
        });

        imageInput.addEventListener('change', function() {
            const file = imageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.innerHTML = `<img src="${e.target.result}" alt="Превью изображения" class="img-fluid">`;
                };
                reader.readAsDataURL(file);
            } else {
                previewImage.textContent = 'Нет изображения';
                previewImage.innerHTML = '';
            }
        });
    });
</script>


{% endblock %}
